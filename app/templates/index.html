<!DOCTYPE HTML>
<html>
<head>
    <title>GHG Reduction Simulator</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/3.0.4/socket.io.js" integrity="sha512-aMGMvNYu8Ue4G+fHa359jcPb1u+ytAF+P2SCb+PxrjCdO3n3ZTxJ30zuH39rimUggmTwmh2u7wvQsDTHESnmfQ==" crossorigin="anonymous"></script>
    <script type="text/javascript" charset="utf-8">
        $(document).ready(function() {
            var socket = io();
            let valueDict = {{ valueDict | tojson }};

            socket.on('connect', function() {
                while (document.getElementById("login").firstChild) {
                    document.getElementById("login").firstChild.remove();
                };
                var nameText = document.createElement('input');
                nameText.setAttribute('type','text');
                nameText.setAttribute('id','loginName');
                var nameLabel = document.createElement('label');
                nameLabel.setAttribute('for','loginName');
                nameLabel.innerText = 'User name : ';
                document.getElementById('login').appendChild(nameLabel);
                document.getElementById('login').appendChild(nameText);
                document.getElementById('login').appendChild(document.createElement('br'));
                var nameText = document.createElement('input');
                nameText.setAttribute('type','password');
                nameText.setAttribute('id','loginPW');
                var nameLabel = document.createElement('label');
                nameLabel.setAttribute('for','loginPW');
                nameLabel.innerText = 'Password : ';
                document.getElementById('login').appendChild(nameLabel);
                document.getElementById('login').appendChild(nameText);
                var applyButton = document.createElement('input');
                applyButton.setAttribute('type','submit');
                applyButton.setAttribute('id','showPW');
                applyButton.setAttribute('value','Show');
                document.getElementById('login').appendChild(applyButton);
                document.getElementById('login').appendChild(document.createElement('br'));
                var applyButton = document.createElement('input');
                applyButton.setAttribute('type','submit');
                applyButton.setAttribute('id','loginButton');
                applyButton.setAttribute('value','Login');
                document.getElementById('login').appendChild(applyButton);
                document.getElementById('login').appendChild(document.createElement('br'));
                document.getElementById('login').appendChild(document.createElement('br'));
                var applyButton = document.createElement('input');
                applyButton.setAttribute('type','submit');
                applyButton.setAttribute('id','createAccountButton');
                applyButton.setAttribute('value','Create new account');
                var nameLabel = document.createElement('label');
                nameLabel.setAttribute('for','createAccountButton');
                nameLabel.setAttribute('id','createAccountLabel');
                nameLabel.innerText = 'If you do not have any accounts, you can create it : ';
                document.getElementById('login').appendChild(nameLabel);
                document.getElementById('login').appendChild(applyButton);
                document.getElementById('login').appendChild(document.createElement('br'));
                socket.emit('connect_event');
            });
            socket.on('my_response_connect', function(msg, cb) {
            });
            socket.on('my_response_login', function(msg, cb) {
                var userName = msg.name;
                var ifLogin = msg.iflogin;
                var userDict = JSON.parse(msg.userDict)
                var exist = msg.exist
                while (document.getElementById("loginUsers").firstChild) {
                    document.getElementById("loginUsers").firstChild.remove();
                };
                while (document.getElementById("userTable").firstChild) {
                    document.getElementById("userTable").firstChild.remove();
                };
                if (ifLogin == 'Create') {
                    if (exist) {
                        var sentence = "The name already exists. Please input another name.";
                        var text = document.createTextNode(sentence);
                        document.getElementById('login').appendChild(text);
                    } else {
                        while (document.getElementById("login").firstChild) {
                            document.getElementById("login").firstChild.remove();
                        };
                        var sentence = "Hello " + userName + ", your account has been successfully created.";
                        var text = document.createTextNode(sentence);
                        document.getElementById('login').appendChild(text);
                        document.getElementById('login').appendChild(document.createElement('br'));
                        var newGameButton = document.createElement('input');
                        newGameButton.setAttribute('type','submit');
                        newGameButton.setAttribute('value','New game');
                        newGameButton.setAttribute('id','newGameButton');
                        document.getElementById('gameSelect').appendChild(newGameButton);
                        //var selectGameButton = document.createElement('input');
                        //selectGameButton.setAttribute('type','submit');
                        //selectGameButton.setAttribute('value','Select game');
                        //selectGameButton.setAttribute('id','selectGameButton');
                        //document.getElementById('gameSelect').appendChild(selectGameButton);
                    };
                } else if (exist) {
                    while (document.getElementById("login").firstChild) {
                        document.getElementById("login").firstChild.remove();
                    };
                    var sentence = "Welcome back, " + userName + ".";
                    var text = document.createTextNode(sentence);
                    document.getElementById('login').appendChild(text);
                    document.getElementById('login').appendChild(document.createElement('br'));
                    var newGameButton = document.createElement('input');
                    newGameButton.setAttribute('type','submit');
                    newGameButton.setAttribute('value','New game');
                    newGameButton.setAttribute('id','newGameButton');
                    document.getElementById('gameSelect').appendChild(newGameButton);
                    //var selectGameButton = document.createElement('input');
                    //selectGameButton.setAttribute('type','submit');
                    //selectGameButton.setAttribute('value','Select game');
                    //selectGameButton.setAttribute('id','selectGameButton');
                    //document.getElementById('gameSelect').appendChild(selectGameButton);
                } else {
                    var sentence = "Your account has not been found. Please reinput User name or Password, or create a new account.";
                    var text = document.createTextNode(sentence);
                    document.getElementById('login').appendChild(text);
                };
            });
            socket.on('my_response_loginTable', function(msg, cb) {
                var userDict = JSON.parse(msg.userDict)
                while (document.getElementById("loginUsers").firstChild) {
                    document.getElementById("loginUsers").firstChild.remove();
                };
                var loginTable = document.createElement('table');
                loginTable.setAttribute('id','loginTable');
                var newRow = loginTable.insertRow(-1);
                var newCell1 = newRow.insertCell(-1);
                newCell1.innerHTML = 'Name'
                var newCell2 = newRow.insertCell(-1);
                newCell2.innerHTML = 'Game'
                for (var name of Object.keys(userDict)) {
                    if (userDict[name]['login']) {
                        var newRow = loginTable.insertRow(-1);
                        var newCell1 = newRow.insertCell(-1);
                        newCell1.innerHTML = name
                        var newCell2 = newRow.insertCell(-1);
                        if (userDict[name]['gameID'] == 0) {
                            newCell2.innerHTML = '<input type="checkbox" class="cbGameSelect" id="cbGameSelect'+name+'">';
                        } else {
                            newCell2.innerHTML = 'Game' + userDict[name]['gameID'];
                        };
                    };
                };
                var bold = document.createElement('strong')
                var sentence = "Login List";
                var text = document.createTextNode(sentence);
                bold.appendChild(text);
                if (userDict[name]['login']) {
                    document.getElementById('loginUsers').appendChild(document.createElement('br'));
                    document.getElementById('loginUsers').appendChild(bold);
                    document.getElementById('loginUsers').appendChild(document.createElement('br'));
                    document.getElementById('loginUsers').appendChild(loginTable);
                    document.getElementById('loginUsers').appendChild(document.createElement('br'));
                };
            });
            socket.on('my_response_newGame', function(msg, cb) {
                while (document.getElementById("gameSelect").firstChild) {
                    document.getElementById("gameSelect").firstChild.remove();
                };
                while (document.getElementById("loginUsers").firstChild) {
                    document.getElementById("loginUsers").firstChild.remove();
                };
                while (document.getElementById("login").firstChild) {
                    document.getElementById("login").firstChild.remove();
                };
                var bold = document.createElement('strong')
                var sentence = "Role Selection";
                var text = document.createTextNode(sentence);
                bold.appendChild(text);
                document.getElementById('userSelection').appendChild(document.createElement('br'));
                document.getElementById('userSelection').appendChild(bold);
                document.getElementById('userSelection').appendChild(document.createElement('br'));
                var regRad = document.createElement('input');
                regRad.setAttribute('type','radio');
                regRad.setAttribute('id','ifReg');
                regRad.setAttribute('value','Regulator');
                regRad.setAttribute('name','ifRegShip');
                var regLabel = document.createElement('label');
                regLabel.setAttribute('for','ifReg');
                regLabel.innerText = 'Regulator : '
                document.getElementById('userSelection').appendChild(regLabel);
                document.getElementById('userSelection').appendChild(regRad);
                document.getElementById('userSelection').appendChild(document.createElement('br'));
                var shipRad = document.createElement('input');
                shipRad.setAttribute('type','radio');
                shipRad.setAttribute('id','ifShp');
                shipRad.setAttribute('value','Shipping Company');
                shipRad.setAttribute('name','ifRegShip');
                var shipLabel = document.createElement('label');
                shipLabel.setAttribute('for','ifShp');
                shipLabel.innerText = 'Shipping Company : '
                document.getElementById('userSelection').appendChild(shipLabel);
                document.getElementById('userSelection').appendChild(shipRad);
                document.getElementById('ifShp').checked = true;
                document.getElementById('userSelection').appendChild(document.createElement('br'));
                //var nameText = document.createElement('input');
                //nameText.setAttribute('type','text');
                //nameText.setAttribute('id','name');
                //var nameLabel = document.createElement('label');
                //nameLabel.setAttribute('for','name');
                //nameLabel.innerText = 'Name : ';
                //document.getElementById('userSelection').appendChild(nameLabel);
                //document.getElementById('userSelection').appendChild(nameText);
                //document.getElementById('userSelection').appendChild(document.createElement('br'));
                var applyButton = document.createElement('input');
                applyButton.setAttribute('type','submit');
                applyButton.setAttribute('id','applyName');
                applyButton.setAttribute('value','Apply');
                document.getElementById('userSelection').appendChild(applyButton);
                var nextButton = document.createElement('input');
                nextButton.setAttribute('type','submit');
                nextButton.setAttribute('id','toOperation');
                nextButton.setAttribute('value','Next');
                nextButton.disabled = true;
                document.getElementById('userSelection').appendChild(nextButton);
                document.getElementById('userSelection').appendChild(document.createElement('br'));
                document.getElementById('userSelection').appendChild(document.createElement('br'));
            });
            socket.on('my_response_userTable', function(msg, cb) {
                var gameDict = JSON.parse(msg.gameDict)
                var i = 0
                var ifStatusRole = true
                while (document.getElementById("userTable").firstChild) {
                    document.getElementById("userTable").firstChild.remove();
                };
                var bold = document.createElement('strong')
                var sentence = "Player List";
                var text = document.createTextNode(sentence);
                bold.appendChild(text);
                document.getElementById('userTable').appendChild(document.createElement('br'));
                document.getElementById('userTable').appendChild(bold);
                document.getElementById('userTable').appendChild(document.createElement('br'));
                var userTable = document.createElement('table');
                userTable.setAttribute('id','userTableID')
                var newRow = userTable.insertRow(-1);
                var newCell1 = newRow.insertCell(-1);
                newCell1.innerHTML = 'Role'
                var newCell2 = newRow.insertCell(-1);
                newCell2.innerHTML = 'Name'
                var newCell3 = newRow.insertCell(-1);
                newCell3.innerHTML = 'Status'
                for (var member of Object.keys(gameDict)) {
                    var newRow = userTable.insertRow(-1);
                    var newCell1 = newRow.insertCell(-1);
                    newCell1.innerHTML = gameDict[member]['userType']
                    var newCell2 = newRow.insertCell(-1);
                    newCell2.innerHTML = gameDict[member]['userName']
                    newCell2.style.color = gameDict[member]['color']
                    var newCell3 = newRow.insertCell(-1);
                    newCell3.innerHTML = gameDict[member]['status']
                    if (gameDict[member]['status'] != 'Role Selected') {
                        ifStatusRole = false;
                    }
                };
                if (ifStatusRole) {
                    document.getElementById('toOperation').disabled = false;
                };
                document.getElementById('userTable').appendChild(userTable);
            });          
            socket.on('my_response_selected_regulator', function(msg, cb) {
                while (document.getElementById("userSelection").firstChild) {
                    document.getElementById("userSelection").removeChild(document.getElementById("userSelection").firstChild);
                }
                $('#log2').append('<br>' + $('<div/>').text('Waiting until other players finish their yearly operation.').html());
            });
            socket.on('my_response_selected_shipComp', function(msg, cb) {
                if (document.getElementById("comment1").firstChild) {
                    document.getElementById("comment1").firstChild.remove();
                };
                while (document.getElementById("userSelection").firstChild) {
                    document.getElementById("userSelection").removeChild(document.getElementById("userSelection").firstChild);
                }
                //$('#log2').append('<br>' + $('<div/>').text(msg.type + ' ' + msg.name + ' in ' + msg.elpsyear).html());
                //$('#log2').append('<br>' + $('<div/>').text(JSON.parse(msg.fleets)['1']['total']['g']).html());
                var bold = document.createElement('strong')
                var sentence = "Fleet List in "+msg.currentYear;
                var text = document.createTextNode(sentence);
                bold.appendChild(text);
                document.getElementById('fleetList').appendChild(document.createElement('br'));
                document.getElementById('fleetList').appendChild(bold);
                document.getElementById('fleetList').appendChild(document.createElement('br'));
                let fleets = JSON.parse(msg.fleets)
                let NumFleet = Object.keys(fleets[msg.NshipComp]).length
                let fleetTable = document.createElement('table');
                fleetTable.setAttribute('id','fleetTable');
                var newRow = fleetTable.insertRow(-1);
                var newCell1 = newRow.insertCell(-1);
                newCell1.innerHTML = 'No.';
                var newCell2 = newRow.insertCell(-1);
                newCell2.innerHTML = 'Delivery year';
                var newCell3 = newRow.insertCell(-1);
                newCell3.innerHTML = 'Fuel type';
                var newCell4 = newRow.insertCell(-1);
                newCell4.innerHTML = 'Capacity [TEU]';
                var newCell5 = newRow.insertCell(-1);
                newCell5.innerHTML = 'WPS';
                var newCell6 = newRow.insertCell(-1);
                newCell6.innerHTML = 'SPS';
                var newCell7 = newRow.insertCell(-1);
                newCell7.innerHTML = 'CCS';
                var newCell8 = newRow.insertCell(-1);
                newCell8.innerHTML = 'Maximum speed [kt]';
                var newCell9 = newRow.insertCell(-1);
                newCell9.innerHTML = 'EEXIreq [g/(ton*NM)]';
                var newCell10 = newRow.insertCell(-1);
                newCell10.innerHTML = 'EEXIatt [g/(ton*NM)]';
                var newCell11 = newRow.insertCell(-1);
                newCell11.innerHTML = 'Scrap';
                var newCell12 = newRow.insertCell(-1);
                newCell12.innerHTML = 'Service speed [kt]';
                for (var keyFleet=1; keyFleet<NumFleet; keyFleet++) {
                    var tOpTemp = fleets[msg.NshipComp][keyFleet]['tOp']
                    if (tOpTemp < msg.tOpSch) {
                        var newRow = fleetTable.insertRow(-1);
                        var newCell1 = newRow.insertCell(-1);
                        newCell1.innerHTML = keyFleet;
                        var newCell2 = newRow.insertCell(-1);
                        newCell2.innerHTML = fleets[msg.NshipComp][keyFleet]['delivery'];
                        var newCell3 = newRow.insertCell(-1);
                        newCell3.innerHTML = fleets[msg.NshipComp][keyFleet]['fuelName'];
                        var newCell4 = newRow.insertCell(-1);
                        newCell4.innerHTML = fleets[msg.NshipComp][keyFleet]['CAPcnt'];
                        var newCell5 = newRow.insertCell(-1);
                        if (fleets[msg.NshipComp][keyFleet]['WPS']) {
                            newCell5.innerHTML = '<input type="checkbox" class="cbs" disabled="disabled" checked id="cbwps'+keyFleet+'">';
                        } else {
                            newCell5.innerHTML = '<input type="checkbox" class="cbs" id="cbwps'+keyFleet+'">';
                        };
                        var newCell6 = newRow.insertCell(-1);
                        if (fleets[msg.NshipComp][keyFleet]['SPS']) {
                            newCell6.innerHTML = '<input type="checkbox" class="cbs" disabled="disabled" checked id="cbsps'+keyFleet+'">';
                        } else {
                            newCell6.innerHTML = '<input type="checkbox" class="cbs" id="cbsps'+keyFleet+'">';
                        };
                        var newCell7 = newRow.insertCell(-1);
                        if (msg.currentYear >= 2030) {  
                            if (fleets[msg.NshipComp][keyFleet]['CCS']) {
                                newCell7.innerHTML = '<input type="checkbox" class="cbs" disabled="disabled" checked id="cbccs'+keyFleet+'">';    
                            } else {
                                newCell7.innerHTML = '<input type="checkbox" class="cbs" id="cbccs'+keyFleet+'">';
                            };
                        } else {
                            if (fleets[msg.NshipComp][keyFleet]['CCS']) {
                                newCell7.innerHTML = '<input type="checkbox" class="cbs" disabled="disabled" checked id="cbccs'+keyFleet+'">';
                            } else {
                                newCell7.innerHTML = '<input type="checkbox" class="cbs" disabled="disabled" id="cbccs'+keyFleet+'">';
                            };
                        };
                        var newCell8 = newRow.insertCell(-1);
                        newCell8.innerHTML = fleets[msg.NshipComp][keyFleet]['vDsgnRed'][tOpTemp];
                        var newCell9 = newRow.insertCell(-1);
                        var EEDIreq = fleets[msg.NshipComp][keyFleet]['EEDIreq'][tOpTemp];
                        newCell9.innerHTML = Math.floor( EEDIreq * Math.pow( 10, 2 ) ) / Math.pow( 10, 2 );
                        var newCell10 = newRow.insertCell(-1);
                        var EEDIatt = fleets[msg.NshipComp][keyFleet]['EEDIatt'][tOpTemp];
                        newCell10.innerHTML = Math.floor( EEDIatt * Math.pow( 10, 2 ) ) / Math.pow( 10, 2 );
                        var newCell11 = newRow.insertCell(-1);
                        if (fleets[msg.NshipComp][keyFleet]['vDsgnRed'][tOpTemp] < valueDict['vMin']) {
                            if (fleets[msg.NshipComp][keyFleet]['delivery'] > msg.currentYear) {
                                newCell11.innerHTML = '<input type="checkbox" disabled="disabled" id="scrap'+keyFleet+'">';
                            } else {
                                newCell11.innerHTML = '<input type="checkbox" disabled="disabled" checked id="scrap'+keyFleet+'">';
                            };
                        } else {
                            newCell11.innerHTML = '<input type="checkbox" id="scrap'+keyFleet+'">';
                        };
                        var newCell12 = newRow.insertCell(-1);
                        var newCell12Select = document.createElement('select');
                        newCell12Select.setAttribute("id",'speed'+keyFleet);
                        //var optionSpeed = document.createElement('option');
                        //optionSpeed.setAttribute('disabled', true);
                        //optionSpeed.setAttribute('selected', true);
                        //optionSpeed.innerHTML = 'Select service speed.';
                        //newCell12Select.appendChild(optionSpeed);
                        for (var i = valueDict['vMin']; i <= fleets[msg.NshipComp][keyFleet]['vDsgnRed'][tOpTemp]; i++) {
                            var optionSpeed = document.createElement('option');
                            optionSpeed.setAttribute('value', i);
                            optionSpeed.innerHTML = i;
                            newCell12Select.appendChild(optionSpeed);
                        };
                        newCell12Select.value = fleets[msg.NshipComp][keyFleet]['vDsgnRed'][tOpTemp];
                        if (fleets[msg.NshipComp][keyFleet]['delivery'] > msg.currentYear) {
                            newRow.style.color = 'grey';
                        }
                        newCell12.appendChild(newCell12Select);
                    };
                };
                document.getElementById('fleetList').appendChild(fleetTable);
                var atOnceButton1 = document.createElement('input');
                atOnceButton1.setAttribute("type","submit");
                atOnceButton1.setAttribute("id","wpsAtOnce");
                atOnceButton1.setAttribute("value","Check all WPS at once");
                document.getElementById('atOnce').appendChild(atOnceButton1);
                var atOnceButton2 = document.createElement('input');
                atOnceButton2.setAttribute("type","submit");
                atOnceButton2.setAttribute("id","spsAtOnce");
                atOnceButton2.setAttribute("value","Check all SPS at once");
                document.getElementById('atOnce').appendChild(atOnceButton2);
                var atOnceButton3 = document.createElement('input');
                atOnceButton3.setAttribute("type","submit");
                atOnceButton3.setAttribute("id","ccsAtOnce");
                atOnceButton3.setAttribute("value","Check all CCS at once");
                document.getElementById('atOnce').appendChild(atOnceButton3);
                var atOnceButton4 = document.createElement('select');
                atOnceButton4.setAttribute("id","speedAtOnceText");
                var optionSpeedAtOnce = document.createElement('option');
                optionSpeedAtOnce.setAttribute('disabled', true);
                optionSpeedAtOnce.setAttribute('selected', true);
                optionSpeedAtOnce.innerHTML = 'Select service speed for all fleets.';
                atOnceButton4.appendChild(optionSpeedAtOnce);
                for (var j = valueDict['vMin']; j <= valueDict['vDsgn']; j++) {
                    var optionSpeedAtOnce = document.createElement('option');
                    optionSpeedAtOnce.setAttribute('value', j);
                    optionSpeedAtOnce.innerHTML = j;
                    atOnceButton4.appendChild(optionSpeedAtOnce);
                };
                document.getElementById('atOnce').appendChild(atOnceButton4);
                var atOnceButton5 = document.createElement('input');
                atOnceButton5.setAttribute("type","submit");
                atOnceButton5.setAttribute("id","speedAtOnceButton");
                atOnceButton5.setAttribute("value","Input");
                document.getElementById('atOnce').appendChild(atOnceButton5);

                if (msg.currentYear <= msg.lastYear-2) {
                    var bold = document.createElement('strong')
                    var sentence = "Order List";
                    var text = document.createTextNode(sentence);
                    bold.appendChild(text);
                    document.getElementById('orderList').appendChild(document.createElement('br'));
                    document.getElementById('orderList').appendChild(bold);
                    document.getElementById('orderList').appendChild(document.createElement('br'));
                    let orderTable = document.createElement('table');
                    orderTable.setAttribute('id','orderTable');
                    var newRow = orderTable.insertRow(-1);
                    var newCell1 = newRow.insertCell(-1);
                    newCell1.innerHTML = 'No.';
                    var newCell2 = newRow.insertCell(-1);
                    newCell2.innerHTML = 'Delivery year';
                    var newCell3 = newRow.insertCell(-1);
                    newCell3.innerHTML = 'Fuel type';
                    var newCell4 = newRow.insertCell(-1);
                    newCell4.innerHTML = 'Capacity [TEU]';
                    var newCell5 = newRow.insertCell(-1);
                    newCell5.innerHTML = 'WPS';
                    var newCell6 = newRow.insertCell(-1);
                    newCell6.innerHTML = 'SPS';
                    var newCell7 = newRow.insertCell(-1);
                    newCell7.innerHTML = 'CCS';
                    var newCell8 = newRow.insertCell(-1);
                    newCell8.innerHTML = 'Maximum speed [kt]';
                    var newCell9 = newRow.insertCell(-1);
                    newCell9.innerHTML = 'EEXIreq [g/(ton*NM)]';
                    var newCell10 = newRow.insertCell(-1);
                    newCell10.innerHTML = 'EEXIatt [g/(ton*NM)]';
                    var newCell11 = newRow.insertCell(-1);
                    var addOrderButton = document.createElement('input');
                    addOrderButton.setAttribute("type","submit");
                    addOrderButton.setAttribute("class","addOrderButtons");
                    addOrderButton.setAttribute("value","Add");
                    newCell11.appendChild(addOrderButton);
                    
                    var newRow = orderTable.insertRow(-1);
                    var newCell1 = newRow.insertCell(-1);
                    newCell1.innerHTML = keyFleet;
                    var newCell2 = newRow.insertCell(-1);
                    newCell2.innerHTML = msg.currentYear + 2;
                    var newCell3 = newRow.insertCell(-1);
                    var newCell3Select = document.createElement('select');
                    newCell3Select.setAttribute('id','fuelTypeSelect'+keyFleet)
                    newCell3Select.setAttribute('class','orderChanges')
                    var fuelTypeArr = ['HFO/Diesel','LNG','NH3','H2']
                    if (msg.currentYear >= valueDict['addSysYear']) {
                        NfuelType = 3;
                    } else {
                        NfuelType = 1;
                    }
                    //var optionFuel = document.createElement('option');
                    //optionFuel.setAttribute('disabled', true);
                    //optionFuel.setAttribute('selected', true);
                    //optionFuel.innerHTML = 'Select fuel type.';
                    //newCell3Select.appendChild(optionFuel);
                    for (var j = 0; j <= NfuelType; j++) {
                        var optionFuel = document.createElement('option');
                        optionFuel.setAttribute('value', fuelTypeArr[j]);
                        optionFuel.innerHTML = fuelTypeArr[j];
                        newCell3Select.appendChild(optionFuel);
                    };
                    newCell3.appendChild(newCell3Select)
                    var newCell4 = newRow.insertCell(-1);
                    var newCell4Select = document.createElement('select');
                    newCell4Select.setAttribute('id','capSelect'+keyFleet)
                    newCell4Select.setAttribute('class','orderChanges')
                    //var optionCAP = document.createElement('option');
                    //optionCAP.setAttribute('disabled', true);
                    //optionCAP.setAttribute('selected', true);
                    //optionCAP.innerHTML = 'Select container capacity.';
                    //newCell4Select.appendChild(optionCAP);
                    for (var j = valueDict['CAPcntMin']; j <= valueDict['CAPcntMax']; j=j+1000) {
                        var optionCAP = document.createElement('option');
                        optionCAP.setAttribute('value', j);
                        optionCAP.innerHTML = j;
                        newCell4Select.appendChild(optionCAP);
                    };
                    newCell4.appendChild(newCell4Select)
                    var newCell5 = newRow.insertCell(-1);
                    newCell5.innerHTML = '<input type="checkbox" class="orderChanges" id="cbwps'+keyFleet+'">';
                    var newCell6 = newRow.insertCell(-1);
                    newCell6.innerHTML = '<input type="checkbox" class="orderChanges" id="cbsps'+keyFleet+'">';
                    var newCell7 = newRow.insertCell(-1);
                    if (msg.currentYear >= 2028) {                            
                        newCell7.innerHTML = '<input type="checkbox" class="orderChanges" id="cbccs'+keyFleet+'">';
                    } else {
                        newCell7.innerHTML = '<input type="checkbox" class="orderChanges" disabled="disabled" id="cbccs'+keyFleet+'">';
                    };
                    var newCell8 = newRow.insertCell(-1);
                    newCell8.innerHTML = 'vDsgnRed';
                    var newCell9 = newRow.insertCell(-1);
                    newCell9.innerHTML = 'EEXIreq';
                    var newCell10 = newRow.insertCell(-1);
                    newCell10.innerHTML = 'EEXIatt';
                    var newCell11 = newRow.insertCell(-1);
                    var removeButton = document.createElement('input');
                    removeButton.setAttribute("type","submit");
                    removeButton.setAttribute('id','remove'+keyFleet)
                    removeButton.setAttribute("class","removeButtons");
                    removeButton.setAttribute("value","Remove");
                    newCell11.appendChild(removeButton);
                    document.getElementById('orderList').appendChild(orderTable);
                    if (document.getElementById('cbwps'+keyFleet).checked) {
                        var WPS = 1;
                    } else {
                        var WPS = 0;
                    }
                    if (document.getElementById('cbsps'+keyFleet).checked) {
                        var SPS = 1;
                    } else {
                        var SPS = 0;
                    }
                    if (document.getElementById('cbccs'+keyFleet).checked) {
                        var CCS = 1;
                    } else {
                        var CCS = 0;
                    }
                    socket.emit('orderList_event', {fuelType: newCell3Select.value, CAPcnt: newCell4Select.value, WPS: WPS, SPS: SPS, CCS: CCS, keyFleet: keyFleet});
                };
                var nextButton = document.createElement('input');
                nextButton.setAttribute('type','submit');
                nextButton.setAttribute('id','showResultButton');
                nextButton.setAttribute('value','Complete operation & show result');
                document.getElementById('nextYear').appendChild(nextButton);
            });

            $(document).on('click', '#showPW', function(){
                if (document.getElementById('loginPW').type == 'password') {
                    document.getElementById('loginPW').type = 'input';
                    document.getElementById('showPW').value = 'Hide';
                } else {
                    document.getElementById('loginPW').type = 'password';
                    document.getElementById('showPW').value = 'Show';
                };
            });
            $(document).on('click', '#loginButton', function(){
                var userName = document.getElementById('loginName').value;
                var password = document.getElementById('loginPW').value;
                var ifLoginCreate = document.getElementById('loginButton').value;
                socket.emit('login_event', {name: userName, pw: password, iflogin: ifLoginCreate});
            });
            $(document).on('click', '#createAccountButton', function(){
                if (document.getElementById("createAccountButton")) {
                    document.getElementById("createAccountButton").remove();
                };
                document.getElementById("createAccountLabel").innerText = 'Please create your new account.';
                document.getElementById("loginButton").value = 'Create';
            });
            $(document).on('click', '#newGameButton', function(){
                var sentence = "Input a game name, select a game span, and choose members to play together.";
                var text = document.createTextNode(sentence);
                document.getElementById('gameSelect').appendChild(text);
                var nameText = document.createElement('input');
                nameText.setAttribute('type','text');
                nameText.setAttribute('id','gameName');
                var nameLabel = document.createElement('label');
                nameLabel.setAttribute('for','gameName');
                nameLabel.innerText = 'Game name : ';
                document.getElementById('gameSelect').appendChild(document.createElement('br'));
                document.getElementById('gameSelect').appendChild(nameLabel);
                document.getElementById('gameSelect').appendChild(nameText);
                var spanSelect = document.createElement('select');
                spanSelect.setAttribute('type','text');
                spanSelect.setAttribute('id','gameSpan');
                for (var i = 1; i <= 6; i++) {
                    var option = document.createElement('option');
                    option.setAttribute('value', 5*i);
                    option.innerHTML = 5*i+' years';
                    spanSelect.appendChild(option);
                };
                spanSelect.value = 10;
                var nameLabel = document.createElement('label');
                nameLabel.setAttribute('for','gameSpan');
                nameLabel.innerText = 'Game span : ';
                document.getElementById('gameSelect').appendChild(document.createElement('br'));
                document.getElementById('gameSelect').appendChild(nameLabel);
                document.getElementById('gameSelect').appendChild(spanSelect);
                if (document.getElementById('newGameButton')) {
                    document.getElementById('newGameButton').remove();
                }
                //document.getElementById('selectGameButton').remove();
                document.getElementById('gameSelect').appendChild(document.createElement('br'));
                document.getElementById('gameSelect').appendChild(document.createElement('br'));
                var applyButton = document.createElement('input');
                applyButton.setAttribute('type','submit');
                applyButton.setAttribute('id','createNewGame');
                applyButton.setAttribute('value','Start');
                document.getElementById('gameSelect').appendChild(applyButton);
            });
            $(document).on('click', '#createNewGame', function(){
                var gameName = document.getElementById('gameName').value;
                var gameSpan = document.getElementById('gameSpan').value;
                var loginTable = document.getElementById('loginTable');
                var rows = loginTable.rows.length
                var memberNo = 0
                var memberDict = {};
                for (var i=1; i<rows; i++) {
                    var name = loginTable.rows[i].cells[0].innerHTML
                    var cb = document.getElementById('cbGameSelect'+name) 
                    if (cb) {
                        if (cb.checked) {
                            memberNo = memberNo + 1;
                            memberDict[memberNo] = name;
                        };
                    };                    
                };
                socket.emit('newGame_event', memberDict, gameName, gameSpan);
            });
            //$(document).on('click', '#selectGameButton', function(){
                //socket.emit('newGame_event');
            //});
            $(document).on('click', '#applyName', function(){
                if (document.getElementById('ifReg').checked) {
                    socket.emit('userSelection_event', {type: 'Regulator'});
                } else {
                    socket.emit('userSelection_event', {type: 'Shipping Company'});
                };
            });
            $(document).on('click', '#toOperation', function(){
                var userTable = document.getElementById('userTableID');
                var rows = userTable.rows.length
                var Nregulator = 0;
                for (var i=1; i<rows; i++) {
                    if (userTable.rows[i].cells[0].innerHTML == 'Regulator') {
                        Nregulator = Nregulator + 1;
                    }
                }
                if (Nregulator <= 1) {
                    socket.emit('userSelected_event');
                } else {
                    var sentence = "Number of regulator can not be larger than 1.";
                    var text = document.createTextNode(sentence);
                    document.getElementById('userTable').appendChild(document.createElement('br'));
                    document.getElementById('userTable').appendChild(text);
                    document.getElementById('userTable').appendChild(document.createElement('br'));
                }
            });
            $(document).on('click', '#wpsAtOnce', function(){
                var sysDict = {};
                var fleetTable = document.getElementById('fleetTable');
                var rows = fleetTable.rows.length
                for (var i=1; i<rows; i++) {
                    var keyFleet = fleetTable.rows[i].cells[0].innerHTML
                    sysDict[keyFleet] = {}
                    if (!(document.getElementById('cbwps'+keyFleet).disabled)) {
                        if (document.getElementById('cbwps'+keyFleet).checked) {
                        document.getElementById('cbwps'+keyFleet).checked = false;
                        } else {
                        document.getElementById('cbwps'+keyFleet).checked = true;
                        }
                    }
                    if (document.getElementById('cbwps'+keyFleet).checked) {
                        sysDict[keyFleet].WPS = 1;
                    } else {
                        sysDict[keyFleet].WPS = 0;
                    }
                    if (document.getElementById('cbsps'+keyFleet).checked) {
                        sysDict[keyFleet].SPS = 1;
                    } else {
                        sysDict[keyFleet].SPS = 0;
                    }
                    if (document.getElementById('cbccs'+keyFleet).checked) {
                        sysDict[keyFleet].CCS = 1;
                    } else {
                        sysDict[keyFleet].CCS = 0;
                    }
                }
                socket.emit('wpsAtOnce_event', sysDict);
            });
            $(document).on('click', '#spsAtOnce', function(){
                var sysDict = {};
                var fleetTable = document.getElementById('fleetTable');
                var rows = fleetTable.rows.length
                for (var i=1; i<rows; i++) {
                    var keyFleet = fleetTable.rows[i].cells[0].innerHTML
                    sysDict[keyFleet] = {}
                    if (!(document.getElementById('cbsps'+keyFleet).disabled)) {
                        if (document.getElementById('cbsps'+keyFleet).checked) {
                            document.getElementById('cbsps'+keyFleet).checked = false;
                        } else {
                            document.getElementById('cbsps'+keyFleet).checked = true;
                        }
                    }
                    if (document.getElementById('cbwps'+keyFleet).checked) {
                        sysDict[keyFleet].WPS = 1;
                    } else {
                        sysDict[keyFleet].WPS = 0;
                    }
                    if (document.getElementById('cbsps'+keyFleet).checked) {
                        sysDict[keyFleet].SPS = 1;
                    } else {
                        sysDict[keyFleet].SPS = 0;
                    }
                    if (document.getElementById('cbccs'+keyFleet).checked) {
                        sysDict[keyFleet].CCS = 1;
                    } else {
                        sysDict[keyFleet].CCS = 0;
                    }
                }
                socket.emit('spsAtOnce_event', sysDict);
            });
            $(document).on('click', '#ccsAtOnce', function(){
                var sysDict = {};
                var fleetTable = document.getElementById('fleetTable');
                var rows = fleetTable.rows.length
                for (var i=1; i<rows; i++) {
                    var keyFleet = fleetTable.rows[i].cells[0].innerHTML
                    if (!(document.getElementById('cbccs'+keyFleet).disabled)) {
                        if (document.getElementById('cbccs'+keyFleet).checked) {
                            document.getElementById('cbccs'+keyFleet).checked = false;
                        } else {
                            document.getElementById('cbccs'+keyFleet).checked = true;
                        }
                    }
                    sysDict[keyFleet] = {}
                    if (document.getElementById('cbwps'+keyFleet).checked) {
                        sysDict[keyFleet].WPS = 1;
                    } else {
                        sysDict[keyFleet].WPS = 0;
                    }
                    if (document.getElementById('cbsps'+keyFleet).checked) {
                        sysDict[keyFleet].SPS = 1;
                    } else {
                        sysDict[keyFleet].SPS = 0;
                    }
                    if (document.getElementById('cbccs'+keyFleet).checked) {
                        sysDict[keyFleet].CCS = 1;
                    } else {
                        sysDict[keyFleet].CCS = 0;
                    }
                }
                socket.emit('ccsAtOnce_event', sysDict);
            });
            $(document).on('click', '#speedAtOnceButton', function(){
                var atOnceSpeed = document.getElementById('speedAtOnceText').value;
                if (atOnceSpeed >= valueDict['vMin']) {
                    socket.emit('speedAtOnce_event', {'val': atOnceSpeed})
                }
            });
            $(document).on('click', '.addOrderButtons', function(){
                socket.emit('addOrder_event');
            });
            $(document).on('click', '.removeButtons', function(){
                var keyFleetThis = parseInt(this.id.substr(6))
                var orderTable = document.getElementById('orderTable');
                var rows = orderTable.rows.length;
                for (var i=1; i<rows-1; i++) {
                    if (parseInt(orderTable.rows[i].cells[0].innerHTML) >= keyFleetThis) {
                        orderTable.rows[i].cells[2].firstChild.value = orderTable.rows[i+1].cells[2].firstChild.value;
                        orderTable.rows[i].cells[3].firstChild.value = orderTable.rows[i+1].cells[3].firstChild.value;
                        orderTable.rows[i].cells[4].firstChild.value = orderTable.rows[i+1].cells[4].firstChild.value;
                        orderTable.rows[i].cells[5].firstChild.value = orderTable.rows[i+1].cells[5].firstChild.value;
                        orderTable.rows[i].cells[6].firstChild.value = orderTable.rows[i+1].cells[6].firstChild.value;
                        orderTable.rows[i].cells[7].innerHTML = orderTable.rows[i+1].cells[7].innerHTML;
                        orderTable.rows[i].cells[8].innerHTML = orderTable.rows[i+1].cells[8].innerHTML;
                        orderTable.rows[i].cells[9].innerHTML = orderTable.rows[i+1].cells[9].innerHTML;
                    }                 
                };
                orderTable.rows[rows-1].remove();
            });
            $(document).on('click', '#showResultButton', function(){
                var fleetDict = {};
                var fleetTable = document.getElementById('fleetTable');
                var fleetRows = fleetTable.rows.length
                for (var i=1; i<fleetRows; i++) {
                    if (fleetTable.rows[i].style.color != 'grey') {
                        var keyFleet = fleetTable.rows[i].cells[0].innerHTML
                        fleetDict[keyFleet] = {}
                        if (document.getElementById('scrap'+keyFleet).checked) {
                            fleetDict[keyFleet].scrap = 1;
                            fleetDict[keyFleet].speed = 0;
                        } else {
                            fleetDict[keyFleet].scrap = 0;
                            fleetDict[keyFleet].speed = document.getElementById('speed'+keyFleet).value;
                        }
                        
                    };
                };
                var orderDict = {};
                if (document.getElementById('orderList').firstChild) {
                    var orderTable = document.getElementById('orderTable');
                    var orderRows = orderTable.rows.length
                    var ifOrder = true;
                    for (var i=1; i<orderRows; i++) {
                        var keyFleet = orderTable.rows[i].cells[0].innerHTML
                        var vDsgnRed = orderTable.rows[i].cells[7].innerHTML
                        if (vDsgnRed < valueDict['vMin']) {
                            ifOrder = false;
                        }
                        orderDict[i] = {}
                        orderDict[i].fuelType = document.getElementById('fuelTypeSelect'+keyFleet).value;
                        orderDict[i].CAPcnt = document.getElementById('capSelect'+keyFleet).value;
                        if (document.getElementById('cbwps'+keyFleet).checked) {
                            orderDict[i].WPS = 1;
                        } else {
                            orderDict[i].WPS = 0;
                        }
                        if (document.getElementById('cbsps'+keyFleet).checked) {
                            orderDict[i].SPS = 1;
                        } else {
                            orderDict[i].SPS = 0;
                        }
                        if (document.getElementById('cbccs'+keyFleet).checked) {
                            orderDict[i].CCS = 1;
                        } else {
                            orderDict[i].CCS = 0;
                        }
                    }
                    if (ifOrder) {
                        while (document.getElementById("fleetList").firstChild) {
                            document.getElementById("fleetList").removeChild(document.getElementById("fleetList").firstChild);
                        }
                        while (document.getElementById("atOnce").firstChild) {
                            document.getElementById("atOnce").removeChild(document.getElementById("atOnce").firstChild);
                        }
                        while (document.getElementById("orderList").firstChild) {
                            document.getElementById("orderList").removeChild(document.getElementById("orderList").firstChild);
                        }
                        while (document.getElementById("nextYear").firstChild) {
                            document.getElementById("nextYear").removeChild(document.getElementById("nextYear").firstChild);
                        }
                        socket.emit('nextYear_event', fleetDict, orderDict);
                    } else {
                        var sentence = "Maximum speed must be larger than 12 kt.";
                        var text = document.createTextNode(sentence);
                        document.getElementById('nextYear').appendChild(document.createElement('br'));
                        document.getElementById('nextYear').appendChild(text);
                    };
                } else {
                    while (document.getElementById("fleetList").firstChild) {
                        document.getElementById("fleetList").removeChild(document.getElementById("fleetList").firstChild);
                    }
                    while (document.getElementById("atOnce").firstChild) {
                        document.getElementById("atOnce").removeChild(document.getElementById("atOnce").firstChild);
                    }
                    while (document.getElementById("orderList").firstChild) {
                        document.getElementById("orderList").removeChild(document.getElementById("orderList").firstChild);
                    }
                    while (document.getElementById("nextYear").firstChild) {
                        document.getElementById("nextYear").removeChild(document.getElementById("nextYear").firstChild);
                    }
                    socket.emit('nextYear_event', fleetDict, orderDict)
                };
            });
            $(document).on('click', '#finishResultButton', function(){
                while (document.getElementById("result").firstChild) {
                    document.getElementById("result").removeChild(document.getElementById("result").firstChild);
                };
                socket.emit('userSelected_event');
            });
            $(document).on('click', '#regNext', function(){
                $('#log2').append('<br>' + $('<div/>').text('Waiting until other players finish their yearly operation.').html());
                var rEEDIreq1 = document.getElementById('rEEDIreq1').value;
                var rEEDIreq2 = document.getElementById('rEEDIreq2').value;
                var rEEDIreq3 = document.getElementById('rEEDIreq3').value;
                var Subsidy = document.getElementById('Subsidy').value;
                var Ctax = document.getElementById('Ctax').value;
                while (document.getElementById('regulator').firstChild) {
                    document.getElementById('regulator').removeChild(document.getElementById("regulator").firstChild);
                }
                socket.emit('regulatorOperation_event', {'rEEDIreq1': rEEDIreq1, 'rEEDIreq2': rEEDIreq2, 'rEEDIreq3': rEEDIreq3, 'Subsidy': Subsidy, 'Ctax': Ctax})
            });
               
            socket.on('my_response_cbGameSelect', function(msg, cb) {
                var cbDict = JSON.parse(msg.cbDict);
                var loginTable = document.getElementById('loginTable');
                var rows = loginTable.rows.length
                for (var i=1; i<rows; i++) {
                    var nameLogin = loginTable.rows[i].cells[0].innerHTML
                    var cb = document.getElementById('cbGameSelect'+nameLogin)
                    if (cb) {
                        for (var name of Object.keys(cbDict)) {
                            if (name == nameLogin) {
                                cb.checked = cbDict[name];
                                cb.disabled = cbDict[name];
                            };
                        };
                    };
                };
            });
            socket.on('my_response_regulator_operation', function(msg, cb) {
                var bold = document.createElement('strong')
                var sentence = "Reduction Rate";
                var text = document.createTextNode(sentence);
                bold.appendChild(text);
                document.getElementById('regulator').appendChild(document.createElement('br'));
                document.getElementById('regulator').appendChild(bold);
                document.getElementById('regulator').appendChild(document.createElement('br'));
                var regDec = JSON.parse(msg.regDec);
                var regTable = document.createElement('table');
                var newRow = regTable.insertRow(-1);
                var newCell1 = newRow.insertCell(-1);
                newCell1.innerHTML = 'wDWT >= 200,000';
                var newCell2 = newRow.insertCell(-1);
                var rateSelect1 = document.createElement('select');
                rateSelect1.setAttribute('id','rEEDIreq1');
                for (var i=0; i<=100; i=i+5) {
                    var rateOption = document.createElement('option');
                    rateOption.setAttribute('value',i);
                    rateOption.innerHTML = i+'%';
                    rateSelect1.appendChild(rateOption);
                };
                newCell2.appendChild(rateSelect1);
                var newRow = regTable.insertRow(-1);
                var newCell1 = newRow.insertCell(-1);
                newCell1.innerHTML = '120,000 <= wDWT < 200,000';
                var newCell2 = newRow.insertCell(-1);
                var rateSelect1 = document.createElement('select');
                rateSelect1.setAttribute('id','rEEDIreq2');
                for (var i=0; i<=100; i=i+5) {
                    var rateOption = document.createElement('option');
                    rateOption.setAttribute('value',i);
                    rateOption.innerHTML = i+'%';
                    rateSelect1.appendChild(rateOption);
                };
                newCell2.appendChild(rateSelect1);
                var newRow = regTable.insertRow(-1);
                var newCell1 = newRow.insertCell(-1);
                newCell1.innerHTML = 'wDWT < 120,000';
                var newCell2 = newRow.insertCell(-1);
                var rateSelect1 = document.createElement('select');
                rateSelect1.setAttribute('id','rEEDIreq3');
                for (var i=0; i<=100; i=i+5) {
                    var rateOption = document.createElement('option');
                    rateOption.setAttribute('value',i);
                    rateOption.innerHTML = i+'%';
                    rateSelect1.appendChild(rateOption);
                };
                newCell2.appendChild(rateSelect1);
                document.getElementById('regulator').appendChild(regTable);

                var bold = document.createElement('strong')
                var sentence = "Subsidy & Carbon Tax";
                var text = document.createTextNode(sentence);
                bold.appendChild(text);
                document.getElementById('regulator').appendChild(document.createElement('br'));
                document.getElementById('regulator').appendChild(bold);
                document.getElementById('regulator').appendChild(document.createElement('br'));
                var regTable = document.createElement('table');
                var newRow = regTable.insertRow(-1);
                var newCell1 = newRow.insertCell(-1);
                newCell1.innerHTML = 'Subsidy rate';
                var newCell2 = newRow.insertCell(-1);
                var rateSelect1 = document.createElement('select');
                rateSelect1.setAttribute('id','Subsidy');
                for (var i=0; i<=100; i=i+5) {
                    var rateOption = document.createElement('option');
                    rateOption.setAttribute('value',i);
                    rateOption.innerHTML = i+'%';
                    rateSelect1.appendChild(rateOption);
                };
                newCell2.appendChild(rateSelect1);
                var newRow = regTable.insertRow(-1);
                var newCell1 = newRow.insertCell(-1);
                newCell1.innerHTML = 'Carbon tax rate';
                var newCell2 = newRow.insertCell(-1);
                var rateSelect1 = document.createElement('select');
                rateSelect1.setAttribute('id','Ctax');
                for (var i=0; i<=100; i=i+5) {
                    var rateOption = document.createElement('option');
                    rateOption.setAttribute('value',i);
                    rateOption.innerHTML = i+'%';
                    rateSelect1.appendChild(rateOption);
                };
                newCell2.appendChild(rateSelect1);
                document.getElementById('regulator').appendChild(regTable);
                var nextButton = document.createElement('input');
                nextButton.setAttribute('type','submit');
                nextButton.setAttribute('value','Next');
                nextButton.setAttribute('id','regNext');
                document.getElementById('regulator').appendChild(document.createElement('br'));
                document.getElementById('regulator').appendChild(nextButton);
            });
            socket.on('my_response_speedAtOnce', function(msg, cb) {
                let fleets = JSON.parse(msg.fleets);
                var fleetTable = document.getElementById('fleetTable');
                var rows = fleetTable.rows.length;
                var atOnceSpeed = msg.speed;
                for (var i=1; i<rows; i++) {
                    var keyFleet = fleetTable.rows[i].cells[0].innerHTML;
                    var tOpTemp = fleets[msg.NshipComp][keyFleet]['tOp'];
                    var vDsgnRed = fleets[msg.NshipComp][keyFleet]['vDsgnRed'][tOpTemp];
                    if (atOnceSpeed <= vDsgnRed) {
                        document.getElementById('speed'+keyFleet).value = atOnceSpeed;
                    } else {
                        document.getElementById('speed'+keyFleet).value = vDsgnRed;
                    };
                };
            });
            socket.on('my_response_addOrder', function(msg, cb) {
                var fleetTable = document.getElementById('fleetTable');
                var rows = fleetTable.rows.length
                var orderTable = document.getElementById('orderTable');
                var rowsOrder = orderTable.rows.length
                var keyFleet = parseInt(fleetTable.rows[rows-1].cells[0].innerHTML) + rowsOrder;
                var newRow = orderTable.insertRow(-1);
                var newCell1 = newRow.insertCell(-1);
                newCell1.innerHTML = keyFleet;
                var newCell2 = newRow.insertCell(-1);
                var currentYear = msg.currentYear;
                newCell2.innerHTML = currentYear
                var newCell3 = newRow.insertCell(-1);
                var newCell3Select = document.createElement('select');
                newCell3Select.setAttribute('id','fuelTypeSelect'+keyFleet)
                newCell3Select.setAttribute('class','orderChanges')
                var fuelTypeArr = ['HFO/Diesel','LNG','NH3','H2']
                if (currentYear >= valueDict['addSysYear']) {
                    NfuelType = 3;
                } else {
                    NfuelType = 1;
                }
                for (var j = 0; j <= NfuelType; j++) {
                    var optionFuel = document.createElement('option');
                    optionFuel.setAttribute('value', fuelTypeArr[j]);
                    optionFuel.innerHTML = fuelTypeArr[j];
                    newCell3Select.appendChild(optionFuel);
                };
                newCell3.appendChild(newCell3Select)
                var newCell4 = newRow.insertCell(-1);
                var newCell4Select = document.createElement('select');
                newCell4Select.setAttribute('id','capSelect'+keyFleet)
                newCell4Select.setAttribute('class','orderChanges')
                for (var j = valueDict['CAPcntMin']; j <= valueDict['CAPcntMax']; j=j+1000) {
                    var optionCAP = document.createElement('option');
                    optionCAP.setAttribute('value', j);
                    optionCAP.innerHTML = j;
                    newCell4Select.appendChild(optionCAP);
                };
                newCell4.appendChild(newCell4Select)
                var newCell5 = newRow.insertCell(-1);
                newCell5.innerHTML = '<input type="checkbox" class="orderChanges" id="cbwps'+keyFleet+'">';
                var newCell6 = newRow.insertCell(-1);
                newCell6.innerHTML = '<input type="checkbox" class="orderChanges" id="cbsps'+keyFleet+'">';
                var newCell7 = newRow.insertCell(-1);
                if (msg.currentYear >= 2028) {                            
                    newCell7.innerHTML = '<input type="checkbox" class="orderChanges" id="cbccs'+keyFleet+'">';
                } else {
                    newCell7.innerHTML = '<input type="checkbox" class="orderChanges" disabled="disabled" id="cbccs'+keyFleet+'">';
                };
                var newCell8 = newRow.insertCell(-1);
                newCell8.innerHTML = 'vDsgnRed';
                var newCell9 = newRow.insertCell(-1);
                newCell9.innerHTML = 'EEXIreq';
                var newCell10 = newRow.insertCell(-1);
                newCell10.innerHTML = 'EEXIatt';
                var newCell11 = newRow.insertCell(-1);
                var remButton = document.createElement('input');
                remButton.setAttribute('id','remove'+keyFleet)
                remButton.setAttribute('class','removeButtons')
                remButton.setAttribute('type','submit')
                remButton.setAttribute('value','Remove')
                newCell11.appendChild(remButton);
                document.getElementById('orderList').appendChild(orderTable);
                if (document.getElementById('cbwps'+keyFleet).checked) {
                    var WPS = 1;
                } else {
                    var WPS = 0;
                }
                if (document.getElementById('cbsps'+keyFleet).checked) {
                    var SPS = 1;
                } else {
                    var SPS = 0;
                }
                if (document.getElementById('cbccs'+keyFleet).checked) {
                    var CCS = 1;
                } else {
                    var CCS = 0;
                }
                socket.emit('orderList_event', {fuelType: newCell3Select.value, CAPcnt: newCell4Select.value, WPS: WPS, SPS: SPS, CCS: CCS, keyFleet: keyFleet});
            });
            socket.on('my_response_orderList', function(msg, cb) {
                var orderTable = document.getElementById('orderTable');
                var rows = orderTable.rows.length
                orderTable.rows[rows-1].cells[1].innerHTML = msg.currentYear + 2;
                orderTable.rows[rows-1].cells[7].innerHTML = msg.vDsgnRed;
                var EEDIreq = Math.floor( msg.EEDIreq * Math.pow( 10, 2 ) ) / Math.pow( 10, 2 );
                orderTable.rows[rows-1].cells[8].innerHTML = EEDIreq;
                var EEDIatt = Math.floor( msg.EEDIatt * Math.pow( 10, 2 ) ) / Math.pow( 10, 2 );
                orderTable.rows[rows-1].cells[9].innerHTML = EEDIatt;
            });
            socket.on('my_response_nextYear', function(msg, cb) {
                var gameDict = JSON.parse(msg.gameDict)
                var ifStatus = true;
                for (var userID of Object.keys(gameDict)) {
                    if (gameDict[userID]['status'] != 'Waiting results') {
                        if (gameDict[userID]['status'] != 'Waiting shipping companies') {
                            ifStatus = false;
                        };
                    };
                };
                if (ifStatus) {
                    socket.emit('yearlyOperation_event');
                };

            });
            socket.on('my_response_yearlyOperation', function(msg, cb) {
                while (document.getElementById("log2").firstChild) {
                    document.getElementById("log2").firstChild.remove();
                };
                var bold = document.createElement('strong')
                var sentence = "Result in "+msg.currentYear;
                var text = document.createTextNode(sentence);
                bold.appendChild(text);
                document.getElementById('result').appendChild(document.createElement('br'));
                document.getElementById('result').appendChild(bold);
                document.getElementById('result').appendChild(document.createElement('br'));
                var figTotal = JSON.parse(msg.figTotal)
                let resultTable = document.createElement('table');
                resultTable.setAttribute('id','resultTable')

                var newRow1 = resultTable.insertRow(-1);
                var newCell1 = newRow1.insertCell(-1);
                var img = document.createElement("img");
                img.src = '/static/'+figTotal['profit'];
                newCell1.appendChild(img);
                var newCell2 = newRow1.insertCell(-1);
                var img = document.createElement("img");
                img.src = '/static/'+figTotal['g'];
                newCell2.appendChild(img);

                var newCell3 = newRow1.insertCell(-1);
                var img = document.createElement("img");
                img.src = '/static/'+figTotal['Idx'];
                newCell3.appendChild(img);

                var newRow2 = resultTable.insertRow(-1);
                var newCell4 = newRow2.insertCell(-1);
                var img = document.createElement("img");
                img.src = '/static/'+figTotal['sale'];
                newCell4.appendChild(img);
                
                var newCell5 = newRow2.insertCell(-1);
                var img = document.createElement("img");
                img.src = '/static/'+figTotal['costAll'];
                newCell5.appendChild(img);

                var newCell6 = newRow2.insertCell(-1);
                var img = document.createElement("img");
                img.src = '/static/'+figTotal['maxCta'];
                newCell6.appendChild(img);
                
                document.getElementById('result').appendChild(resultTable);
                //for (var i=0; i<msg.keyList.length; i++) {
                //    var img = document.createElement("img");
                //    img.src = '/static/'+msg.keyList[i]+'Each'+'.png';
                //    //img.src = '/static/'+msg.keyList[i]+'Total'+'.png';
                //    document.getElementById('result').appendChild(img);
                //};
                document.getElementById('result').appendChild(document.createElement('br'));

                var finishResultButton = document.createElement('input');
                finishResultButton.setAttribute('type','submit');
                finishResultButton.setAttribute('id','finishResultButton');
                if (msg.currentYear < msg.lastYear) {
                    finishResultButton.setAttribute('value','Next year');
                } else {
                    finishResultButton.setAttribute('value','Finish simulation');
                };
                document.getElementById('result').appendChild(finishResultButton);
            });
            socket.on('my_response_result', function(msg, cb) {
                var figEach = JSON.parse(msg.figEach)
                var figTotal = JSON.parse(msg.figTotal)
                var eachOrTotal = document.getElementById('resultChildTable1').rows[1].cells[0].firstChild.value;
                var img = document.getElementById('resultChildTable1').rows[0].cells[0].firstChild;
                var oldSrc = img.src;
                if (eachOrTotal == 'Each') {
                    img.src = '/static/'+figEach['profit'];
                } else {
                    img.src = '/static/'+figTotal['profit'];
                };
                var eachOrTotal = document.getElementById('resultChildTable2').rows[1].cells[0].firstChild.value;
                var img = document.getElementById('resultChildTable2').rows[0].cells[0].firstChild;
                var oldSrc = img.src;
                if (eachOrTotal == 'Each') {
                    img.src = '/static/'+figEach['g'];
                } else {
                    img.src = '/static/'+figTotal['g'];
                };
                var eachOrTotal = document.getElementById('resultChildTable3').rows[1].cells[0].firstChild.value;
                var img = document.getElementById('resultChildTable3').rows[0].cells[0].firstChild;
                var oldSrc = img.src;
                if (eachOrTotal == 'Each') {
                    img.src = '/static/'+figEach['Idx'];
                } else {
                    img.src = '/static/'+figTotal['Idx'];
                };
                var eachOrTotal = document.getElementById('resultChildTable4').rows[1].cells[0].firstChild.value;
                var img = document.getElementById('resultChildTable4').rows[0].cells[0].firstChild;
                var oldSrc = img.src;
                if (eachOrTotal == 'Each') {
                    img.src = '/static/'+figEach['sale'];
                } else {
                    img.src = '/static/'+figTotal['sale'];
                };
                var eachOrTotal = document.getElementById('resultChildTable5').rows[1].cells[0].firstChild.value;
                var img = document.getElementById('resultChildTable5').rows[0].cells[0].firstChild;
                var oldSrc = img.src;
                if (eachOrTotal == 'Each') {
                    img.src = '/static/'+figEach['costAll'];
                } else {
                    img.src = '/static/'+figTotal['costAll'];
                };
                var eachOrTotal = document.getElementById('resultChildTable6').rows[1].cells[0].firstChild.value;
                var img = document.getElementById('resultChildTable6').rows[0].cells[0].firstChild;
                var oldSrc = img.src;
                if (eachOrTotal == 'Each') {
                    img.src = '/static/'+figEach['maxCta'];
                } else {
                    img.src = '/static/'+figTotal['maxCta'];
                };
            });
            
            $(document).on('change', '.cbGameSelect', function(){
                var cbDict = {};
                var loginTable = document.getElementById('loginTable');
                var rows = loginTable.rows.length
                for (var i=1; i<rows; i++) {
                    var name = loginTable.rows[i].cells[0].innerHTML
                    var cb = document.getElementById('cbGameSelect'+name)
                    if (cb) {
                        cbDict[name] = cb.checked;
                    };    
                };
                socket.emit('cbGameSelect_event', cbDict);
            });
            $(document).on('change', '#scrap', function(){
                if (this.checked) {
                    // Just turn the color of line, not emitting app event
                    socket.emit('scrap_event', {val: 1});
                } else {
                    socket.emit('scrap_event', {val: 0});
                }
                
            });
            $(document).on('change', '.cbs', function(){
                var sysDict = {};
                var rows = fleetTable.rows.length
                for (var i=1; i<rows; i++) {
                    var keyFleet = fleetTable.rows[i].cells[0].innerHTML
                    sysDict[keyFleet] = {}
                    if (document.getElementById('cbwps'+keyFleet).checked) {
                        sysDict[keyFleet].WPS = 1;
                    } else {
                        sysDict[keyFleet].WPS = 0;
                    }
                    if (document.getElementById('cbsps'+keyFleet).checked) {
                        sysDict[keyFleet].SPS = 1;
                    } else {
                        sysDict[keyFleet].SPS = 0;
                    }
                    if (document.getElementById('cbccs'+keyFleet).checked) {
                        sysDict[keyFleet].CCS = 1;
                    } else {
                        sysDict[keyFleet].CCS = 0;
                    }
                }
                socket.emit('cbs_event', sysDict);
            });
            $(document).on('change', '.orderChanges', function(){
                var sysDict = {};
                var fuelTypeDict = {};
                var CAPcntDict = {};
                var orderTable = document.getElementById('orderTable');
                var rows = orderTable.rows.length
                for (var i = 1; i < rows; i++) {
                    sysDict[i] = {}
                    var keyFleet = orderTable.rows[i].cells[0].innerHTML
                    if (document.getElementById('cbwps'+keyFleet).checked) {
                        sysDict[i].WPS = 1;
                    } else {
                        sysDict[i].WPS = 0;
                    }
                    if (document.getElementById('cbsps'+keyFleet).checked) {
                        sysDict[i].SPS = 1;
                    } else {
                        sysDict[i].SPS = 0;
                    }
                    if (document.getElementById('cbccs'+keyFleet).checked) {
                        sysDict[i].CCS = 1;
                    } else {
                        sysDict[i].CCS = 0;
                    }
                    fuelTypeDict[i] = document.getElementById('fuelTypeSelect'+keyFleet).value
                    CAPcntDict[i] = document.getElementById('capSelect'+keyFleet).value
                }
                socket.emit('orderChange_event', fuelTypeDict, CAPcntDict, sysDict);
            });
            $(document).on('change', '.resultSelect', function(){
                socket.emit('resultSelect_event');
            });

            socket.on('my_response_refurbish', function(msg, cb) {
                let fleets = JSON.parse(msg.fleets)
                let NumFleet = Object.keys(fleets[msg.NshipComp]).length
                var numAlive = 0
                var fleetTable = document.getElementById('fleetTable');
                for (var keyFleet=1; keyFleet<NumFleet; keyFleet++) {
                    var tOpTemp = fleets[msg.NshipComp][keyFleet]['tOp']
                    if (fleets[msg.NshipComp][keyFleet]['delivery'] <= msg.currentYear & tOpTemp < msg.tOpSch) {
                        fleetTable.rows[numAlive+1].cells[7].innerHTML = fleets[msg.NshipComp][keyFleet]['vDsgnRed'][tOpTemp];
                        var EEDIreq = fleets[msg.NshipComp][keyFleet]['EEDIreq'][tOpTemp];
                        fleetTable.rows[numAlive+1].cells[8].innerHTML = Math.floor( EEDIreq * Math.pow( 10, 2 ) ) / Math.pow( 10, 2 );
                        var EEDIatt = fleets[msg.NshipComp][keyFleet]['EEDIatt'][tOpTemp];
                        fleetTable.rows[numAlive+1].cells[9].innerHTML = Math.floor( EEDIatt * Math.pow( 10, 2 ) ) / Math.pow( 10, 2 );
                        var selected = fleetTable.rows[numAlive+1].cells[11].firstChild.value;
                        fleetTable.rows[numAlive+1].cells[11].firstChild.remove();
                        var newCell12Select = document.createElement('select');
                        newCell12Select.setAttribute("id",'speed'+keyFleet);
                        //var optionSpeed = document.createElement('option');
                        //optionSpeed.setAttribute('disabled', true);
                        //optionSpeed.innerHTML = 'Select service speed.';
                        //newCell12Select.appendChild(optionSpeed);
                        for (var i = valueDict['vMin']; i <= fleets[msg.NshipComp][keyFleet]['vDsgnRed'][tOpTemp]; i++) {
                            var optionSpeed = document.createElement('option');
                            optionSpeed.setAttribute('value', i);
                            optionSpeed.innerHTML = i;
                            newCell12Select.appendChild(optionSpeed);
                        };
                        newCell12Select.value = selected
                        fleetTable.rows[numAlive+1].cells[11].appendChild(newCell12Select);
                        numAlive += 1
                    }
                }
            });
            socket.on('my_response_orderChange', function(msg, cb) {
                var orderTable = document.getElementById('orderTable');
                var rows = orderTable.rows.length
                var orderList = JSON.parse(msg.orderList)
                for (var keyFleet=1; keyFleet<rows; keyFleet++) {
                    orderTable.rows[keyFleet].cells[7].innerHTML = orderList[keyFleet]['vDsgnRed'];
                    var EEDIreq = orderList[keyFleet]['EEDIreq'];
                    orderTable.rows[keyFleet].cells[8].innerHTML = Math.floor( EEDIreq * Math.pow( 10, 2 ) ) / Math.pow( 10, 2 );
                    var EEDIatt = orderList[keyFleet]['EEDIatt'];
                    orderTable.rows[keyFleet].cells[9].innerHTML = Math.floor( EEDIatt * Math.pow( 10, 2 ) ) / Math.pow( 10, 2 );
                }
            });
            socket.on('my_response_scrap', function(msg, cb) {
                let fleets = JSON.parse(msg.fleets)
                let NumFleet = Object.keys(fleets[msg.NshipComp]).length
                var numAlive = 0
                for (var keyFleet=1; keyFleet<NumFleet; keyFleet++) {
                    var tOpTemp = fleets[msg.NshipComp][keyFleet]['tOp']
                    if (fleets[msg.NshipComp][keyFleet]['delivery'] <= msg.currentYear & tOpTemp < msg.tOpSch) {
                        // change color by CSS later if scrap check box is checked
                        numAlive += 1
                    }
                }
            });

            socket.on('redirect', function(data) {
                $('#log2').append('<br>' + $('<div/>').text('Oh2').html());
                window.location = data.url;
            });

            $('form#broadcast').submit(function(event) {
                socket.emit('my_broadcast_event', {data: $('#broadcast_data').val()});
                return false;
            });
            $('form#userSelection').submit(function(event) {
                socket.emit('userSelection_event', {type: document.getElementById("userSelection").radio.value, name: $('#name').val()});
                return false;
            });
        });
    </script>
</head>
<body>
    <h1>GHG Reduction Simulator</h1>
    <div id ='comment1'></div>
    <div id='login'></div>
    <div id='loginUsers'></div>
    <div id ='newGame'></div>
    <div id ='gameSelect'></div>
    <div id ='userSelection'></div>
    <div id ='userTable'></div>
    <br>
    <div id='regulator'></div>
    <div id ='fleetList'></div>
    <div id ='atOnce'></div>
    <br>
    <div id ='orderList'></div>
    <br>
    <div id ='nextYear'></div>
    <br>
    <div id ='result'></div>
    <div id="log2"></div>
    <div id="logMessage"></div>
    <div id="logMessage"></div>

</body>
</html>